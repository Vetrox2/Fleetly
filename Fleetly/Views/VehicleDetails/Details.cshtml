@using Fleetly.Models.ViewModels
@model VehicleDetailsViewModel
@{
    ViewBag.Title = "Vehicle Details";
}
<h2>Vehicle Details</h2>
<form asp-action="UpdateVehicle" method="post">
    <input type="hidden" name="id" value="@Model.Vehicle.Id" />
    <div>
        <label>Make:</label>
        <input name="Make" value="@Model.Vehicle.Make" />
        <label>Model:</label>
        <input name="Model" value="@Model.Vehicle.Model" />
        <label>Year:</label>
        <input name="Year" type="number" value="@Model.Vehicle.Year" />
        <button type="submit">Save Vehicle</button>
    </div>
</form>

<hr />
<h3>Routes</h3>
<table>
    <thead>
        <tr><th>Addresses</th><th>Actions</th></tr>
    </thead>
    <tbody>
    @foreach(var route in Model.Routes)
    {
        <tr>
            <td>
                <ul>
                @for(int i = 0; i < route.Addresses.Count; i++)
                {
                    <li>
                        @route.Addresses[i].Street, @route.Addresses[i].City
                        <form asp-action="DeleteAddress" method="post" style="display:inline">
                            <input type="hidden" name="vehicleId" value="@Model.Vehicle.Id" />
                            <input type="hidden" name="routeId" value="@route.Id" />
                            <input type="hidden" name="index" value="@i" />
                            <button type="submit">Delete Address</button>
                        </form>
                    </li>
                }
                </ul>
                <form asp-action="AddAddress" method="post">
                    <input type="hidden" name="vehicleId" value="@Model.Vehicle.Id" />
                    <input type="hidden" name="routeId" value="@route.Id" />
                    <input name="address.Street" placeholder="Street" />
                    <input name="address.City" placeholder="City" />
                    <button type="submit">Add Address</button>
                </form>
            </td>
            <td>
                <form asp-action="DeleteRoute" method="post">
                    <input type="hidden" name="vehicleId" value="@Model.Vehicle.Id" />
                    <input type="hidden" name="routeId" value="@route.Id" />
                    <button type="submit">Delete Route</button>
                </form>
            </td>
        </tr>
    }
    <tr>
        <td colspan="2">
            <form asp-action="AddRoute" method="post">
                <input type="hidden" name="vehicleId" value="@Model.Vehicle.Id" />
                <button type="submit">Add New Route</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<hr />
<h3>Inspections</h3>
<table>
    <thead>
        <tr><th>Date</th><th>Passed</th><th>Valid Until</th><th>Comments</th><th>Actions</th></tr>
    </thead>
    <tbody>
    @foreach(var insp in Model.Inspections)
    {
        <tr>
            <td>@insp.DatePerformed.ToShortDateString()</td>
            <td>@insp.IsPassed</td>
            <td>@insp.ValidUntil.ToShortDateString()</td>
            <td>
                <ul>
                @foreach(var c in insp.Comments)
                {
                    <li>@c.Timestamp.ToShortDateString(): @c.Text</li>
                }
                </ul>
                <form asp-action="AddComment" method="post">
                    <input type="hidden" name="vehicleId" value="@Model.Vehicle.Id" />
                    <input type="hidden" name="inspectionId" value="@insp.Id" />
                    <input name="comment.Text" placeholder="Comment" />
                    <button type="submit">Add Comment</button>
                </form>
            </td>
            <td>
                <form asp-action="DeleteInspection" method="post">
                    <input type="hidden" name="vehicleId" value="@Model.Vehicle.Id" />
                    <input type="hidden" name="inspectionId" value="@insp.Id" />
                    <button type="submit">Delete Inspection</button>
                </form>
            </td>
        </tr>
    }
    <tr>
        <td colspan="5">
            <form asp-action="AddInspection" method="post">
                <input type="hidden" name="vehicleId" value="@Model.Vehicle.Id" />
                <input name="inspection.DatePerformed" type="date" required />
                <label>Passed?</label><input name="inspection.IsPassed" type="checkbox" />
                <input name="inspection.ValidUntil" type="date" required />
                <button type="submit">Add Inspection</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>